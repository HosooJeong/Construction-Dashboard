 {
            var project = projects[i];
            html += '<div class="project-item">';
            html += '<div class="project-name">' + project.name + '</div>';
            html += '<div class="project-location">' + project.location + ' | ' + project.status + '</div>';
            html += '<div class="project-progress">';
            html += '<div class="progress-bar">';
            html += '<div class="progress-fill" style="width: ' + project.progress + '%"></div>';
            html += '</div>';
            html += '<div class="progress-text">' + project.progress + '%</div>';
            html += '</div>';
            html += '</div>';
        }
        
        html += '</div>';
        regionsGrid.innerHTML = html;
    }
    
    if (backButton) {
        backButton.style.display = 'block';
    }
}

// 현장 목록 렌더링
function renderSiteList(containerId, sites, region) {
    var container = document.getElementById(containerId);
    if (!container) return;
    
    var sitesToShow = [];
    var totalVolume = 0;
    
    if (containerId === 'concrete-sites') {
        // 레미콘 타설 현장의 경우 권역별 필터링
        if (region === '전국' || !region) {
            Object.keys(sites).forEach(function(key) {
                sitesToShow = sitesToShow.concat(sites[key]);
            });
        } else {
            sitesToShow = sites[region] || [];
        }
        
        // 총 타설량 계산
        sitesToShow.forEach(function(site) {
            totalVolume += site.volume || 0;
        });
        
        // 요약 정보 업데이트
        updateConcreteSummary(sitesToShow.length, totalVolume);
    } else if (containerId === 'paving-sites') {
        // 도로 포장 현장의 경우 권역별 필터링
        var totalArea = 0;
        
        if (region === '전국' || !region) {
            Object.keys(sites).forEach(function(key) {
                sitesToShow = sitesToShow.concat(sites[key]);
            });
        } else {
            sitesToShow = sites[region] || [];
        }
        
        // 총 포장면적 계산
        sitesToShow.forEach(function(site) {
            totalArea += site.area || 0;
        });
        
        // 요약 정보 업데이트
        updatePavingSummary(sitesToShow.length, totalArea);
    } else {
        // 다른 현장들은 기존 방식
        sitesToShow = sites;
    }
    
    var html = '';
    for (var i = 0; i < sitesToShow.length; i++) {
        var site = sitesToShow[i];
        html += '<div class="site-item">';
        html += '<div class="site-info">';
        html += '<div class="site-name">' + site.name + '</div>';
        html += '<div class="site-details">' + site.location + '</div>';
        html += '</div>';
        
        // 레미콘 타설량 정보 표시
        if (containerId === 'concrete-sites' && site.volume) {
            html += '<div class="volume-info">';
            html += '<div class="volume-amount">' + site.volume + '</div>';
            html += '<div class="volume-unit">㎥</div>';
            html += '</div>';
        }

        // 도로 포장면적 정보 표시
        if (containerId === 'paving-sites' && site.area) {
            html += '<div class="area-info">';
            html += '<div class="area-amount">' + site.area.toLocaleString() + '</div>';
            html += '<div class="area-unit">㎡</div>';
            html += '</div>';
        }
        
        if (site.weather && site.weatherData) {
            html += '<div class="weather-icon weather-' + site.weather + '" onmouseenter="showTooltip(event, \'' + site.weather + '\', ' + JSON.stringify(site.weatherData).replace(/"/g, '&quot;') + ', \'' + containerId + '\')" onmouseleave="hideTooltip()">';
            html += getWeatherIcon(site.weather);
            html += '</div>';
        } else if (site.weather) {
            html += '<div class="weather-icon weather-' + site.weather + '">';
            html += getWeatherIcon(site.weather);
            html += '</div>';
        }
        
        html += '</div>';
    }
    container.innerHTML = html;
}

// 도로 포장 요약 정보 업데이트
function updatePavingSummary(siteCount, totalArea) {
    var siteCountEl = document.getElementById('paving-site-count');
    var totalAreaEl = document.getElementById('paving-total-area');
    
    if (siteCountEl) {
        siteCountEl.textContent = siteCount + '개소';
    }
    
    if (totalAreaEl) {
        totalAreaEl.textContent = totalArea.toLocaleString() + '㎡';
    }
}

// 레미콘 요약 정보 업데이트
function updateConcreteSummary(siteCount, totalVolume) {
    var siteCountEl = document.getElementById('concrete-site-count');
    var totalVolumeEl = document.getElementById('concrete-total-volume');
    
    if (siteCountEl) {
        siteCountEl.textContent = siteCount + '개소';
    }
    
    if (totalVolumeEl) {
        totalVolumeEl.textContent = totalVolume.toLocaleString() + '㎥';
    }
}

// 품질 차트 렌더링
function renderQualityChart(region) {
    var container = document.getElementById('quality-chart');
    if (!container) return;
    
    region = region || currentQualityRegion || '전국';
    var data = qualityData[region] || qualityData['전국'];
    
    var html = '';
    var total = 0;
    for (var i = 0; i < data.length; i++) {
        total += data[i].count;
    }
    
    for (var i = 0; i < data.length; i++) {
        var item = data[i];
        var percentage = Math.round((item.count / total) * 100);
        
        html += '<div class="quality-bar">';
        html += '<div class="quality-label quality-' + item.color + '">' + item.label + '</div>';
        html += '<div class="bar-container">';
        html += '<div class="bar-fill bar-' + item.color + '" style="width: ' + percentage + '%">';
        if (percentage > 15) {
            html += percentage + '%';
        }
        html += '</div>';
        html += '</div>';
        html += '<div class="quality-count">' + item.count + '</div>';
        html += '</div>';
    }
    
    container.innerHTML = html;
}

// 날씨 아이콘 가져오기
function getWeatherIcon(weatherType) {
    var icons = {
        'rain': '🌧️',
        'hot': '🌡️',
        'cold': '❄️',
        'wind': '💨'
    };
    return icons[weatherType] || '☁️';
}

// 툴팁 표시
function showTooltip(event, weatherType, weatherData, siteType) {
    hideTooltip(); // 기존 툴팁 제거
    
    var tooltip = document.createElement('div');
    tooltip.className = 'weather-tooltip';
    tooltip.id = 'weather-tooltip';
    
    // 툴팁 내용 생성
    var tooltipHtml = '';
    
    // 헤더
    tooltipHtml += '<div class="tooltip-header">';
    tooltipHtml += '<div class="tooltip-icon">' + getWeatherIcon(weatherType) + '</div>';
    tooltipHtml += '<div class="tooltip-title">' + getWeatherTitle(weatherType) + '</div>';
    tooltipHtml += '</div>';
    
    // 현재 기상 데이터
    tooltipHtml += '<div class="tooltip-content">';
    tooltipHtml += '<div class="weather-data">';
    tooltipHtml += '<span class="weather-label">현재 상황:</span>';
    tooltipHtml += '<span class="weather-value ' + (weatherData.status === 'critical' ? 'weather-critical' : 'weather-safe') + '">';
    tooltipHtml += weatherData.current + weatherData.unit;
    tooltipHtml += '</span>';
    tooltipHtml += '</div>';
    
    tooltipHtml += '<div class="weather-data">';
    tooltipHtml += '<span class="weather-label">예보:</span>';
    tooltipHtml += '<span class="weather-value">' + weatherData.forecast + '</span>';
    tooltipHtml += '</div>';
    
    // 품질관리 기준
    tooltipHtml += '<div class="quality-standard">';
    tooltipHtml += '<div class="standard-title">품질관리 기준</div>';
    tooltipHtml += '<div class="standard-text">';
    tooltipHtml += getQualityStandard(weatherType, siteType) + '<br>';
    tooltipHtml += '기준값: ' + weatherData.standard;
    tooltipHtml += '</div>';
    tooltipHtml += '</div>';
    
    tooltipHtml += '</div>';
    
    tooltip.innerHTML = tooltipHtml;
    document.body.appendChild(tooltip);
    
    // 위치 계산
    positionTooltip(tooltip, event);
    
    // 표시
    setTimeout(function() {
        tooltip.style.opacity = '1';
        tooltip.style.visibility = 'visible';
    }, 10);
}

// 툴팁 숨기기
function hideTooltip() {
    var existingTooltip = document.getElementById('weather-tooltip');
    if (existingTooltip) {
        existingTooltip.remove();
    }
}

// 툴팁 위치 계산
function positionTooltip(tooltip, event) {
    var rect = tooltip.getBoundingClientRect();
    var x = event.clientX;
    var y = event.clientY;
    
    // 화면 경계 확인
    var windowWidth = window.innerWidth;
    var windowHeight = window.innerHeight;
    var tooltipWidth = 320; // max-width 값
    var tooltipHeight = rect.height || 200; // 예상 높이
    
    // X 위치 조정
    if (x + tooltipWidth > windowWidth - 20) {
        x = windowWidth - tooltipWidth - 20;
    }
    if (x < 20) {
        x = 20;
    }
    
    // Y 위치 조정
    if (y + tooltipHeight > windowHeight - 20) {
        y = y - tooltipHeight - 20;
    } else {
        y = y + 20;
    }
    
    tooltip.style.left = x + 'px';
    tooltip.style.top = y + 'px';
}

// 날씨 제목
function getWeatherTitle(weatherType) {
    var titles = {
        'rain': '강수량 정보',
        'hot': '기온 정보',
        'cold': '저온 정보',
        'wind': '풍속 정보'
    };
    return titles[weatherType] || '기상 정보';
}

// 공사 종류별 품질관리 기준
function getQualityStandard(weatherType, siteType) {
    var standards = {
        'concrete-sites': {
            'rain': '콘크리트 타설 시 강수량이 기준을 초과하면 작업 중단',
            'wind': '강풍 시 타워크레인 및 고소작업 금지',
            'hot': '고온 시 양생 관리 및 수분 공급 필수',
            'cold': '저온 시 동결방지제 사용 및 보온양생 실시'
        },
        'compaction-sites': {
            'rain': '다짐작업 시 강수로 인한 함수비 증가 방지',
            'wind': '강풍 시 장비 작업 안전성 확보',
            'hot': '고온 시 재료 품질 관리 및 작업시간 조정',
            'cold': '저온 시 동결 방지 및 다짐 품질 확보'
        },
        'paving-sites': {
            'rain': '아스팔트 포장 시 강수는 작업품질에 치명적',
            'wind': '강풍 시 포장재료 비산 방지 및 안전관리',
            'hot': '고온에서 아스팔트 품질저하 방지 조치 필요',
            'cold': '저온 시 포장재 온도관리 및 다짐 품질 확보'
        }
    };
    
    return standards[siteType] && standards[siteType][weatherType] 
        ? standards[siteType][weatherType]
        : '현장 안전 및 품질관리 준수';
}

// 메시지 전송
function sendMessage() {
    var chatInput = document.getElementById('chat-input');
    var chatMessages = document.getElementById('chat-messages');
    
    if (!chatInput || !chatMessages) return;
    
    var message = chatInput.value.trim();
    if (!message) return;
    
    // 사용자 메시지 추가
    var userMessage = document.createElement('div');
    userMessage.className = 'chat-message chat-user';
    userMessage.textContent = message;
    chatMessages.appendChild(userMessage);
    
    // 입력창 초기화
    chatInput.value = '';
    
    // 봇 응답 (간단한 자동 응답)
    setTimeout(function() {
        var botMessage = document.createElement('div');
        botMessage.className = 'chat-message chat-bot';
        
        var responses = [
            '좋은 질문이네요! 품질관리 기준서를 확인해보시기 바랍니다.',
            '해당 내용은 현장 담당자와 상의하시는 것이 좋겠습니다.',
            '품질관리 매뉴얼에서 더 자세한 정보를 확인하실 수 있습니다.',
            '현재 기상상황을 고려하여 작업계획을 수정하시기 바랍니다.'
        ];
        
        var randomResponse = responses[Math.floor(Math.random() * responses.length)];
        botMessage.innerHTML = randomResponse;
        
        chatMessages.appendChild(botMessage);
        
        // 스크롤을 맨 아래로
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }, 1000);
    
    // 스크롤을 맨 아래로
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// 알림 표시
function showAlert(message) {
    // 기존 알림 제거
    var existingAlert = document.querySelector('.notification');
    if (existingAlert) {
        existingAlert.remove();
    }
    
    var notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // 3초 후 자동 제거
    setTimeout(function() {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}

// SMS 모달 표시
function showSMSModal() {
    var modal = document.getElementById('sms-modal');
    if (!modal) {
        createSMSModal();
        modal = document.getElementById('sms-modal');
    }
    
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
}

// SMS 모달 숨기기
function hideSMSModal() {
    var modal = document.getElementById('sms-modal');
    if (modal) {
        modal.classList.remove('show');
        document.body.style.overflow = 'auto';
    }
}

// SMS 모달 HTML 생성
function createSMSModal() {
    var modalHtml = `
        <div class="sms-modal" id="sms-modal" onclick="hideSMSModal()">
            <div class="sms-modal-content" onclick="event.stopPropagation()">
                <div class="sms-modal-header">
                    <h3 class="sms-modal-title">📱 현장 안전 문자 발송</h3>
                    <button class="sms-close" onclick="hideSMSModal()">×</button>
                </div>
                
                <div class="sms-form-group">
                    <label class="sms-label">수신 대상</label>
                    <input type="text" class="sms-input" value="현장 관리자 (5명)" readonly>
                </div>
                
                <div class="sms-form-group">
                    <label class="sms-label">메시지 내용</label>
                    <textarea class="sms-textarea" id="sms-message" placeholder="안전 관련 메시지를 입력하세요...">
[긴급] 기상특보 안내

현재 강풍주의보가 발효 중입니다.
- 풍속: 18.5m/s (기준: 15m/s 이하)
- 예상시간: 오후 6시까지

▣ 즉시 조치사항
• 타워크레인 작업 즉시 중단
• 고소작업 금지
• 자재 고정 점검
• 작업자 대피

안전 제일! 기상상황 호전 시까지 작업을 중단해 주세요.

- 본사 품질관리팀</textarea>
                    <div class="sms-char-count">
                        <span id="char-count">0</span>/2000자
                    </div>
                </div>
                
                <div class="sms-buttons">
                    <button class="sms-btn sms-btn-cancel" onclick="hideSMSModal()">취소</button>
                    <button class="sms-btn sms-btn-send" onclick="sendSMS()">발송</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // 문자수 카운터 이벤트 추가
    var textarea = document.getElementById('sms-message');
    var charCount = document.getElementById('char-count');
    
    if (textarea && charCount) {
        // 초기 문자수 설정
        charCount.textContent = textarea.value.length;
        
        textarea.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });
    }
}

// SMS 발송
function sendSMS() {
    var message = document.getElementById('sms-message').value.trim();
    
    if (!message) {
        showAlert('메시지 내용을 입력해주세요.');
        return;
    }
    
    // 발송 시뮬레이션
    hideSMSModal();
    showAlert('📱 현장 관리자 5명에게 안전 문자가 발송되었습니다!');
}

// 초기화 실행
document.addEventListener('DOMContentLoaded', function() {
    init();
});

    </script>
</body>
</html>