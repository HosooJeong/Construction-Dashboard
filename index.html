 {
            var project = projects[i];
            html += '<div class="project-item">';
            html += '<div class="project-name">' + project.name + '</div>';
            html += '<div class="project-location">' + project.location + ' | ' + project.status + '</div>';
            html += '<div class="project-progress">';
            html += '<div class="progress-bar">';
            html += '<div class="progress-fill" style="width: ' + project.progress + '%"></div>';
            html += '</div>';
            html += '<div class="progress-text">' + project.progress + '%</div>';
            html += '</div>';
            html += '</div>';
        }
        
        html += '</div>';
        regionsGrid.innerHTML = html;
    }
    
    if (backButton) {
        backButton.style.display = 'block';
    }
}

// í˜„ì¥ ëª©ë¡ ë Œë”ë§
function renderSiteList(containerId, sites, region) {
    var container = document.getElementById(containerId);
    if (!container) return;
    
    var sitesToShow = [];
    var totalVolume = 0;
    
    if (containerId === 'concrete-sites') {
        // ë ˆë¯¸ì½˜ íƒ€ì„¤ í˜„ì¥ì˜ ê²½ìš° ê¶Œì—­ë³„ í•„í„°ë§
        if (region === 'ì „êµ­' || !region) {
            Object.keys(sites).forEach(function(key) {
                sitesToShow = sitesToShow.concat(sites[key]);
            });
        } else {
            sitesToShow = sites[region] || [];
        }
        
        // ì´ íƒ€ì„¤ëŸ‰ ê³„ì‚°
        sitesToShow.forEach(function(site) {
            totalVolume += site.volume || 0;
        });
        
        // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
        updateConcreteSummary(sitesToShow.length, totalVolume);
    } else if (containerId === 'paving-sites') {
        // ë„ë¡œ í¬ì¥ í˜„ì¥ì˜ ê²½ìš° ê¶Œì—­ë³„ í•„í„°ë§
        var totalArea = 0;
        
        if (region === 'ì „êµ­' || !region) {
            Object.keys(sites).forEach(function(key) {
                sitesToShow = sitesToShow.concat(sites[key]);
            });
        } else {
            sitesToShow = sites[region] || [];
        }
        
        // ì´ í¬ì¥ë©´ì  ê³„ì‚°
        sitesToShow.forEach(function(site) {
            totalArea += site.area || 0;
        });
        
        // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
        updatePavingSummary(sitesToShow.length, totalArea);
    } else {
        // ë‹¤ë¥¸ í˜„ì¥ë“¤ì€ ê¸°ì¡´ ë°©ì‹
        sitesToShow = sites;
    }
    
    var html = '';
    for (var i = 0; i < sitesToShow.length; i++) {
        var site = sitesToShow[i];
        html += '<div class="site-item">';
        html += '<div class="site-info">';
        html += '<div class="site-name">' + site.name + '</div>';
        html += '<div class="site-details">' + site.location + '</div>';
        html += '</div>';
        
        // ë ˆë¯¸ì½˜ íƒ€ì„¤ëŸ‰ ì •ë³´ í‘œì‹œ
        if (containerId === 'concrete-sites' && site.volume) {
            html += '<div class="volume-info">';
            html += '<div class="volume-amount">' + site.volume + '</div>';
            html += '<div class="volume-unit">ã¥</div>';
            html += '</div>';
        }

        // ë„ë¡œ í¬ì¥ë©´ì  ì •ë³´ í‘œì‹œ
        if (containerId === 'paving-sites' && site.area) {
            html += '<div class="area-info">';
            html += '<div class="area-amount">' + site.area.toLocaleString() + '</div>';
            html += '<div class="area-unit">ã¡</div>';
            html += '</div>';
        }
        
        if (site.weather && site.weatherData) {
            html += '<div class="weather-icon weather-' + site.weather + '" onmouseenter="showTooltip(event, \'' + site.weather + '\', ' + JSON.stringify(site.weatherData).replace(/"/g, '&quot;') + ', \'' + containerId + '\')" onmouseleave="hideTooltip()">';
            html += getWeatherIcon(site.weather);
            html += '</div>';
        } else if (site.weather) {
            html += '<div class="weather-icon weather-' + site.weather + '">';
            html += getWeatherIcon(site.weather);
            html += '</div>';
        }
        
        html += '</div>';
    }
    container.innerHTML = html;
}

// ë„ë¡œ í¬ì¥ ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
function updatePavingSummary(siteCount, totalArea) {
    var siteCountEl = document.getElementById('paving-site-count');
    var totalAreaEl = document.getElementById('paving-total-area');
    
    if (siteCountEl) {
        siteCountEl.textContent = siteCount + 'ê°œì†Œ';
    }
    
    if (totalAreaEl) {
        totalAreaEl.textContent = totalArea.toLocaleString() + 'ã¡';
    }
}

// ë ˆë¯¸ì½˜ ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
function updateConcreteSummary(siteCount, totalVolume) {
    var siteCountEl = document.getElementById('concrete-site-count');
    var totalVolumeEl = document.getElementById('concrete-total-volume');
    
    if (siteCountEl) {
        siteCountEl.textContent = siteCount + 'ê°œì†Œ';
    }
    
    if (totalVolumeEl) {
        totalVolumeEl.textContent = totalVolume.toLocaleString() + 'ã¥';
    }
}

// í’ˆì§ˆ ì°¨íŠ¸ ë Œë”ë§
function renderQualityChart(region) {
    var container = document.getElementById('quality-chart');
    if (!container) return;
    
    region = region || currentQualityRegion || 'ì „êµ­';
    var data = qualityData[region] || qualityData['ì „êµ­'];
    
    var html = '';
    var total = 0;
    for (var i = 0; i < data.length; i++) {
        total += data[i].count;
    }
    
    for (var i = 0; i < data.length; i++) {
        var item = data[i];
        var percentage = Math.round((item.count / total) * 100);
        
        html += '<div class="quality-bar">';
        html += '<div class="quality-label quality-' + item.color + '">' + item.label + '</div>';
        html += '<div class="bar-container">';
        html += '<div class="bar-fill bar-' + item.color + '" style="width: ' + percentage + '%">';
        if (percentage > 15) {
            html += percentage + '%';
        }
        html += '</div>';
        html += '</div>';
        html += '<div class="quality-count">' + item.count + '</div>';
        html += '</div>';
    }
    
    container.innerHTML = html;
}

// ë‚ ì”¨ ì•„ì´ì½˜ ê°€ì ¸ì˜¤ê¸°
function getWeatherIcon(weatherType) {
    var icons = {
        'rain': 'ğŸŒ§ï¸',
        'hot': 'ğŸŒ¡ï¸',
        'cold': 'â„ï¸',
        'wind': 'ğŸ’¨'
    };
    return icons[weatherType] || 'â˜ï¸';
}

// íˆ´íŒ í‘œì‹œ
function showTooltip(event, weatherType, weatherData, siteType) {
    hideTooltip(); // ê¸°ì¡´ íˆ´íŒ ì œê±°
    
    var tooltip = document.createElement('div');
    tooltip.className = 'weather-tooltip';
    tooltip.id = 'weather-tooltip';
    
    // íˆ´íŒ ë‚´ìš© ìƒì„±
    var tooltipHtml = '';
    
    // í—¤ë”
    tooltipHtml += '<div class="tooltip-header">';
    tooltipHtml += '<div class="tooltip-icon">' + getWeatherIcon(weatherType) + '</div>';
    tooltipHtml += '<div class="tooltip-title">' + getWeatherTitle(weatherType) + '</div>';
    tooltipHtml += '</div>';
    
    // í˜„ì¬ ê¸°ìƒ ë°ì´í„°
    tooltipHtml += '<div class="tooltip-content">';
    tooltipHtml += '<div class="weather-data">';
    tooltipHtml += '<span class="weather-label">í˜„ì¬ ìƒí™©:</span>';
    tooltipHtml += '<span class="weather-value ' + (weatherData.status === 'critical' ? 'weather-critical' : 'weather-safe') + '">';
    tooltipHtml += weatherData.current + weatherData.unit;
    tooltipHtml += '</span>';
    tooltipHtml += '</div>';
    
    tooltipHtml += '<div class="weather-data">';
    tooltipHtml += '<span class="weather-label">ì˜ˆë³´:</span>';
    tooltipHtml += '<span class="weather-value">' + weatherData.forecast + '</span>';
    tooltipHtml += '</div>';
    
    // í’ˆì§ˆê´€ë¦¬ ê¸°ì¤€
    tooltipHtml += '<div class="quality-standard">';
    tooltipHtml += '<div class="standard-title">í’ˆì§ˆê´€ë¦¬ ê¸°ì¤€</div>';
    tooltipHtml += '<div class="standard-text">';
    tooltipHtml += getQualityStandard(weatherType, siteType) + '<br>';
    tooltipHtml += 'ê¸°ì¤€ê°’: ' + weatherData.standard;
    tooltipHtml += '</div>';
    tooltipHtml += '</div>';
    
    tooltipHtml += '</div>';
    
    tooltip.innerHTML = tooltipHtml;
    document.body.appendChild(tooltip);
    
    // ìœ„ì¹˜ ê³„ì‚°
    positionTooltip(tooltip, event);
    
    // í‘œì‹œ
    setTimeout(function() {
        tooltip.style.opacity = '1';
        tooltip.style.visibility = 'visible';
    }, 10);
}

// íˆ´íŒ ìˆ¨ê¸°ê¸°
function hideTooltip() {
    var existingTooltip = document.getElementById('weather-tooltip');
    if (existingTooltip) {
        existingTooltip.remove();
    }
}

// íˆ´íŒ ìœ„ì¹˜ ê³„ì‚°
function positionTooltip(tooltip, event) {
    var rect = tooltip.getBoundingClientRect();
    var x = event.clientX;
    var y = event.clientY;
    
    // í™”ë©´ ê²½ê³„ í™•ì¸
    var windowWidth = window.innerWidth;
    var windowHeight = window.innerHeight;
    var tooltipWidth = 320; // max-width ê°’
    var tooltipHeight = rect.height || 200; // ì˜ˆìƒ ë†’ì´
    
    // X ìœ„ì¹˜ ì¡°ì •
    if (x + tooltipWidth > windowWidth - 20) {
        x = windowWidth - tooltipWidth - 20;
    }
    if (x < 20) {
        x = 20;
    }
    
    // Y ìœ„ì¹˜ ì¡°ì •
    if (y + tooltipHeight > windowHeight - 20) {
        y = y - tooltipHeight - 20;
    } else {
        y = y + 20;
    }
    
    tooltip.style.left = x + 'px';
    tooltip.style.top = y + 'px';
}

// ë‚ ì”¨ ì œëª©
function getWeatherTitle(weatherType) {
    var titles = {
        'rain': 'ê°•ìˆ˜ëŸ‰ ì •ë³´',
        'hot': 'ê¸°ì˜¨ ì •ë³´',
        'cold': 'ì €ì˜¨ ì •ë³´',
        'wind': 'í’ì† ì •ë³´'
    };
    return titles[weatherType] || 'ê¸°ìƒ ì •ë³´';
}

// ê³µì‚¬ ì¢…ë¥˜ë³„ í’ˆì§ˆê´€ë¦¬ ê¸°ì¤€
function getQualityStandard(weatherType, siteType) {
    var standards = {
        'concrete-sites': {
            'rain': 'ì½˜í¬ë¦¬íŠ¸ íƒ€ì„¤ ì‹œ ê°•ìˆ˜ëŸ‰ì´ ê¸°ì¤€ì„ ì´ˆê³¼í•˜ë©´ ì‘ì—… ì¤‘ë‹¨',
            'wind': 'ê°•í’ ì‹œ íƒ€ì›Œí¬ë ˆì¸ ë° ê³ ì†Œì‘ì—… ê¸ˆì§€',
            'hot': 'ê³ ì˜¨ ì‹œ ì–‘ìƒ ê´€ë¦¬ ë° ìˆ˜ë¶„ ê³µê¸‰ í•„ìˆ˜',
            'cold': 'ì €ì˜¨ ì‹œ ë™ê²°ë°©ì§€ì œ ì‚¬ìš© ë° ë³´ì˜¨ì–‘ìƒ ì‹¤ì‹œ'
        },
        'compaction-sites': {
            'rain': 'ë‹¤ì§ì‘ì—… ì‹œ ê°•ìˆ˜ë¡œ ì¸í•œ í•¨ìˆ˜ë¹„ ì¦ê°€ ë°©ì§€',
            'wind': 'ê°•í’ ì‹œ ì¥ë¹„ ì‘ì—… ì•ˆì „ì„± í™•ë³´',
            'hot': 'ê³ ì˜¨ ì‹œ ì¬ë£Œ í’ˆì§ˆ ê´€ë¦¬ ë° ì‘ì—…ì‹œê°„ ì¡°ì •',
            'cold': 'ì €ì˜¨ ì‹œ ë™ê²° ë°©ì§€ ë° ë‹¤ì§ í’ˆì§ˆ í™•ë³´'
        },
        'paving-sites': {
            'rain': 'ì•„ìŠ¤íŒ”íŠ¸ í¬ì¥ ì‹œ ê°•ìˆ˜ëŠ” ì‘ì—…í’ˆì§ˆì— ì¹˜ëª…ì ',
            'wind': 'ê°•í’ ì‹œ í¬ì¥ì¬ë£Œ ë¹„ì‚° ë°©ì§€ ë° ì•ˆì „ê´€ë¦¬',
            'hot': 'ê³ ì˜¨ì—ì„œ ì•„ìŠ¤íŒ”íŠ¸ í’ˆì§ˆì €í•˜ ë°©ì§€ ì¡°ì¹˜ í•„ìš”',
            'cold': 'ì €ì˜¨ ì‹œ í¬ì¥ì¬ ì˜¨ë„ê´€ë¦¬ ë° ë‹¤ì§ í’ˆì§ˆ í™•ë³´'
        }
    };
    
    return standards[siteType] && standards[siteType][weatherType] 
        ? standards[siteType][weatherType]
        : 'í˜„ì¥ ì•ˆì „ ë° í’ˆì§ˆê´€ë¦¬ ì¤€ìˆ˜';
}

// ë©”ì‹œì§€ ì „ì†¡
function sendMessage() {
    var chatInput = document.getElementById('chat-input');
    var chatMessages = document.getElementById('chat-messages');
    
    if (!chatInput || !chatMessages) return;
    
    var message = chatInput.value.trim();
    if (!message) return;
    
    // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
    var userMessage = document.createElement('div');
    userMessage.className = 'chat-message chat-user';
    userMessage.textContent = message;
    chatMessages.appendChild(userMessage);
    
    // ì…ë ¥ì°½ ì´ˆê¸°í™”
    chatInput.value = '';
    
    // ë´‡ ì‘ë‹µ (ê°„ë‹¨í•œ ìë™ ì‘ë‹µ)
    setTimeout(function() {
        var botMessage = document.createElement('div');
        botMessage.className = 'chat-message chat-bot';
        
        var responses = [
            'ì¢‹ì€ ì§ˆë¬¸ì´ë„¤ìš”! í’ˆì§ˆê´€ë¦¬ ê¸°ì¤€ì„œë¥¼ í™•ì¸í•´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.',
            'í•´ë‹¹ ë‚´ìš©ì€ í˜„ì¥ ë‹´ë‹¹ìì™€ ìƒì˜í•˜ì‹œëŠ” ê²ƒì´ ì¢‹ê² ìŠµë‹ˆë‹¤.',
            'í’ˆì§ˆê´€ë¦¬ ë§¤ë‰´ì–¼ì—ì„œ ë” ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
            'í˜„ì¬ ê¸°ìƒìƒí™©ì„ ê³ ë ¤í•˜ì—¬ ì‘ì—…ê³„íšì„ ìˆ˜ì •í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.'
        ];
        
        var randomResponse = responses[Math.floor(Math.random() * responses.length)];
        botMessage.innerHTML = randomResponse;
        
        chatMessages.appendChild(botMessage);
        
        // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }, 1000);
    
    // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// ì•Œë¦¼ í‘œì‹œ
function showAlert(message) {
    // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
    var existingAlert = document.querySelector('.notification');
    if (existingAlert) {
        existingAlert.remove();
    }
    
    var notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // 3ì´ˆ í›„ ìë™ ì œê±°
    setTimeout(function() {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}

// SMS ëª¨ë‹¬ í‘œì‹œ
function showSMSModal() {
    var modal = document.getElementById('sms-modal');
    if (!modal) {
        createSMSModal();
        modal = document.getElementById('sms-modal');
    }
    
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
}

// SMS ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
function hideSMSModal() {
    var modal = document.getElementById('sms-modal');
    if (modal) {
        modal.classList.remove('show');
        document.body.style.overflow = 'auto';
    }
}

// SMS ëª¨ë‹¬ HTML ìƒì„±
function createSMSModal() {
    var modalHtml = `
        <div class="sms-modal" id="sms-modal" onclick="hideSMSModal()">
            <div class="sms-modal-content" onclick="event.stopPropagation()">
                <div class="sms-modal-header">
                    <h3 class="sms-modal-title">ğŸ“± í˜„ì¥ ì•ˆì „ ë¬¸ì ë°œì†¡</h3>
                    <button class="sms-close" onclick="hideSMSModal()">Ã—</button>
                </div>
                
                <div class="sms-form-group">
                    <label class="sms-label">ìˆ˜ì‹  ëŒ€ìƒ</label>
                    <input type="text" class="sms-input" value="í˜„ì¥ ê´€ë¦¬ì (5ëª…)" readonly>
                </div>
                
                <div class="sms-form-group">
                    <label class="sms-label">ë©”ì‹œì§€ ë‚´ìš©</label>
                    <textarea class="sms-textarea" id="sms-message" placeholder="ì•ˆì „ ê´€ë ¨ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
[ê¸´ê¸‰] ê¸°ìƒíŠ¹ë³´ ì•ˆë‚´

í˜„ì¬ ê°•í’ì£¼ì˜ë³´ê°€ ë°œíš¨ ì¤‘ì…ë‹ˆë‹¤.
- í’ì†: 18.5m/s (ê¸°ì¤€: 15m/s ì´í•˜)
- ì˜ˆìƒì‹œê°„: ì˜¤í›„ 6ì‹œê¹Œì§€

â–£ ì¦‰ì‹œ ì¡°ì¹˜ì‚¬í•­
â€¢ íƒ€ì›Œí¬ë ˆì¸ ì‘ì—… ì¦‰ì‹œ ì¤‘ë‹¨
â€¢ ê³ ì†Œì‘ì—… ê¸ˆì§€
â€¢ ìì¬ ê³ ì • ì ê²€
â€¢ ì‘ì—…ì ëŒ€í”¼

ì•ˆì „ ì œì¼! ê¸°ìƒìƒí™© í˜¸ì „ ì‹œê¹Œì§€ ì‘ì—…ì„ ì¤‘ë‹¨í•´ ì£¼ì„¸ìš”.

- ë³¸ì‚¬ í’ˆì§ˆê´€ë¦¬íŒ€</textarea>
                    <div class="sms-char-count">
                        <span id="char-count">0</span>/2000ì
                    </div>
                </div>
                
                <div class="sms-buttons">
                    <button class="sms-btn sms-btn-cancel" onclick="hideSMSModal()">ì·¨ì†Œ</button>
                    <button class="sms-btn sms-btn-send" onclick="sendSMS()">ë°œì†¡</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // ë¬¸ììˆ˜ ì¹´ìš´í„° ì´ë²¤íŠ¸ ì¶”ê°€
    var textarea = document.getElementById('sms-message');
    var charCount = document.getElementById('char-count');
    
    if (textarea && charCount) {
        // ì´ˆê¸° ë¬¸ììˆ˜ ì„¤ì •
        charCount.textContent = textarea.value.length;
        
        textarea.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });
    }
}

// SMS ë°œì†¡
function sendSMS() {
    var message = document.getElementById('sms-message').value.trim();
    
    if (!message) {
        showAlert('ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // ë°œì†¡ ì‹œë®¬ë ˆì´ì…˜
    hideSMSModal();
    showAlert('ğŸ“± í˜„ì¥ ê´€ë¦¬ì 5ëª…ì—ê²Œ ì•ˆì „ ë¬¸ìê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
}

// ì´ˆê¸°í™” ì‹¤í–‰
document.addEventListener('DOMContentLoaded', function() {
    init();
});

    </script>
</body>
</html>